<div class="container-fluid">
  <div class="row">
    <div class="col-md-3">
      <%= render 'public/partial/userinfo', user: @user, book: @book, reading_lists: @reading_lists, readed_books_count: @readed_books_count, recommenbook: @recommenbook, in_release_reviews: @in_release_reviews %>
    </div>
    
    <div class="col-md-8 offset-md-1">
      <h2 class="page-title">
        <% if @user == current_user %>
          あなたが読んだ本
        <% else %>
          <%= @user.name %>さんが読んだ本
        <% end %>
      </h2>
      
      <% if @readed_books.present? %>
        <table class="table table-hover table-inverse">
          <thead class="text-center">
            <tr>
              <th style="width: 10%"></th>
              <th style="width: 20%">タイトル</th>
              <th style="width: 20%">著　　者</th>
              <th>読み終わった日</th>
            </tr>
          </thead>
          <% @readed_books.each do |readed| %>
          <% book = RakutenWebService::Books::Book.search(isbn: readed.isbn, outOfStockFlag: 1).first %>
          <tbody>
            <tr>
              <td>
                <%= link_to book_path(book.isbn) do %>
                  <%= image_tag(book['medium_image_url']) %>
                <% end %>
              </td>
              <td>
                <%= link_to book_path(book.isbn) do %>
                  <%= book['title'] %>
                <% end %>
              </td>
              <td><%= book['author'] %></td>
              <td>
                <% if readed.readed_at.nil? %>
                  不明
                <% else %>
                  <%= @user.reviews.where(isbn: readed.isbn).where.not(readed_at: nil).order(readed_at: :DESC).pluck(:readed_at).first&.strftime('%Y/%m/%d') %>
                <% end %>
              </td>
            </tr>
          </tbody>
          <% end %>
        </table>
      
      <% else %>
        <h4>読み終わった本はまだありません</h4>
      
      <% end %>
      
    </div>
  </div>
</div>

