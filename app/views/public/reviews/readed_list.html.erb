<!--条件分岐確認OK-->
<div class="container-fluid">
  <div class="row flex-row">
    <div class="col-lg-3 d-none d-lg-block">
      <%= render 'public/partial/userinfo', user: @user, book: @book, reading_lists: @reading_lists, readed_lists_count: @readed_lists_count, recommenbook: @recommenbook, in_release_reviews: @in_release_reviews %>
    </div>
    
    <div class="col-lg-8 offset-lg-1">
      <h2 class="page-title">
        <% if @user == current_user %>
          あなたが読んだ本
        <% else %>
          <%= @user.name %>さんが読んだ本
        <% end %>
      </h2>
      
      <% if @readed_lists.present? %>
        <table class="table table-sm">
          <thead class="text-center">
            <tr>
              <th style="width: 10%"></th>
              <th style="width: 30%">タイトル</th>
              <th style="width: 20%">著者</th>
              <th>読み終わった日</th>
            </tr>
          </thead>
          <% @readed_lists.each do |readed| %>
          <% book = RakutenWebService::Books::Book.search(isbn: readed.isbn, outOfStockFlag: 1).first %>
          <tbody>
            <tr>
              <td>
                <%= link_to book_path(book.isbn) do %>
                  <%= image_tag(book['small_image_url']) %>
                <% end %>
              </td>
              <td>
                <%= link_to book_path(book.isbn) do %>
                  <%= book['title'] %>
                <% end %>
              </td>
              <td>
                <%= link_to books_search_path(author: book['author']) do %>
                  <%= book['author'] %>
                <% end %>
              </td>
              <td class="text-center">
                <% latest_readed_at = readed.latest_readed_at %>
                <% if latest_readed_at.present? %>
                  <%= DateTime.parse(latest_readed_at)&.strftime('%Y/%m/%d') %>
                <% else %>
                  不明
                <% end %>
              </td>
            </tr>
          </tbody>
          <% end %>
        </table>
      
      <% else %>
        <p class="ml-2">読んだ本がまだありません</p>
      <% end %>
      
    </div>
  </div>
</div>

