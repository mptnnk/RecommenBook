<!--条件分岐確認OK-->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-3">
      <%= render 'public/partial/userinfo', user: @user, book: @book, reading_lists: @reading_lists, readed_lists_count: @readed_lists_count, recommenbook: @recommenbook, in_release_reviews: @in_release_reviews %>
    </div>
    
    <div class="col-md-8 offset-md-1">
      <h2 class="page-title">
        <% if @user == current_user %>
          Your Readed Lists
        <% else %>
          <%= @user.name %>'s Readed Lists
        <% end %>
      </h2>
      
      <% if @readed_lists.present? %>
        <table class="table table-hover table-inverse">
          <thead class="text-center">
            <tr>
              <th style="width: 20%"></th>
              <th style="width: 30%">Title</th>
              <th style="width: 20%">Author</th>
              <th>Readed date</th>
            </tr>
          </thead>
          <% @readed_lists.each do |readed| %>
          <% book = RakutenWebService::Books::Book.search(isbn: readed.isbn, outOfStockFlag: 1).first %>
          <tbody>
            <tr>
              <td>
                <%= link_to book_path(book.isbn) do %>
                  <%= image_tag(book['medium_image_url']) %>
                <% end %>
              </td>
              <td>
                <%= link_to book_path(book.isbn) do %>
                  <%= book['title'] %>
                <% end %>
              </td>
              <td><%= book['author'] %></td>
              <td class="text-center">
                <% latest_readed_at = readed.latest_readed_at %>
                <% if latest_readed_at.present? %>
                  <%= DateTime.parse(latest_readed_at)&.strftime('%Y/%m/%d') %>
                <% else %>
                  不明
                <% end %>
              </td>
            </tr>
          </tbody>
          <% end %>
        </table>
      
      <% else %>
        <h5 class="ml-2">No Readed Lists</h5>
      <% end %>
      
    </div>
  </div>
</div>

